<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stress Predictor - MindWell</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2">
  <style>
    body { margin:0; font-family:'Inter',sans-serif; background:linear-gradient(135deg,#00796b,#4a968d); color:#fff; min-height:100vh; display:flex; flex-direction:column; align-items:center;}
    .predictor-container { width:90%; max-width:900px; margin:2rem 0; }
    .predictor-card { background: rgba(255,255,255,0.08); padding:2rem; border-radius:16px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
    .slider-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-top:1rem; }
    input[type="range"]{ -webkit-appearance:none; width:100%; height:10px; border-radius:6px; background:rgba(255,255,255,0.2);}
    .btn-primary-full{ background:#ffb347; color:#000; padding:0.8rem 1.2rem; border-radius:12px; border:0; font-weight:700; cursor:pointer;}
    .results-card{ background: rgba(0,0,0,0.25); padding:1rem; margin-top:1rem; border-radius:12px;}
    label{ font-weight:600; display:block; margin-bottom:0.3rem;}
    input[type="text"], textarea{ width:100%; padding:0.5rem; border-radius:8px; border:1px solid rgba(255,255,255,0.12); background:transparent; color:#fff; }
    input[type="text"]::placeholder, textarea::placeholder{ color: #ddd; }
    .small-muted { opacity:0.85; font-size:0.95rem; }
    .param-list { margin:0.5rem 0 0 1rem; }
  </style>
</head>
<body>

 <div class="predictor-container">
  <div class="predictor-card">
    <h1>üìä Stress Level Analysis</h1>
    <p class="small-muted">Logged in as: <strong>{{ username }}</strong></p>

    <form action="{{ url_for('predictor') }}" method="POST">
      <input type="hidden" name="patient_name" value="{{ username }}">

      <div style="display:flex; gap:1rem; margin-bottom:1rem;">
        <div style="flex:1;">
          <label for="symptoms">Symptoms (short)</label>
          <input type="text" id="symptoms" name="symptoms" placeholder="e.g., trouble sleeping, anxious" value="{{ symptoms_short }}">
        </div>
      </div>

      <div style="margin-bottom:1rem;">
        <label for="symptoms_long">Symptoms (details, optional)</label>
        <textarea id="symptoms_long" name="symptoms_long" rows="3" placeholder="Provide more details (optional)">{{ symptoms_long }}</textarea>
      </div>

      <div class="slider-grid">
        {% for feature in features %}
        <div>
          <label for="{{ feature }}">{{ feature.replace('_',' ').title() }}</label>
          <input type="range" id="{{ feature }}" name="{{ feature }}" min="1" max="10" value="{{ request.form.get(feature,5) }}">
          <div style="display:flex; justify-content:space-between; font-size:0.9rem; opacity:0.9;">
            <small>1</small><small id="{{ feature }}-value">{{ request.form.get(feature,5) }}</small><small>10</small>
          </div>
        </div>
        {% endfor %}
      </div>

      <div style="margin-top:1rem;">
        <button type="submit" class="btn-primary-full">Analyze My Stress</button>
      </div>
    </form>

    {% if prediction %}
    <div id="results" class="results-card">
      <h2>‚úÖ Analysis Complete</h2>
      <p>Your Predicted Stress Level:</p>
      <p style="font-size:1.6rem; font-weight:800; margin:0.2rem 0;" class="level-{{ prediction.level | lower }}">{{ prediction.level }}</p>

      <div style="margin-top:0.5rem;">
        <strong>Prediction probabilities:</strong>
        <div class="small-muted">Low: {{ prediction.probabilities.Low|round(1) }}% ‚Äî Medium: {{ prediction.probabilities.Medium|round(1) }}% ‚Äî High: {{ prediction.probabilities.High|round(1) }}%</div>
      </div>

      <div class="recommendations" style="margin-top:1rem;">
        <h4>üå± Personalized Recommendations</h4>
        <ul>
          {% if prediction.recommendations %}
            <li><strong>Parameters needing attention (High / risky):</strong>
              <ul class="param-list">
                {% for rec in prediction.recommendations %}
                  <li><strong>{{ rec.factor.replace('_',' ').title() }} ({{ rec.value }})</strong>: {{ rec.tip }}</li>
                {% endfor %}
              </ul>
            </li>
          {% endif %}

          {% if prediction.maintain %}
            <li><strong>Parameters to maintain (Low-risk):</strong>
              <ul class="param-list">
                {% for m in prediction.maintain %}
                  <li><strong>{{ m.factor.replace('_',' ').title() }} ({{ m.value }})</strong>: {{ m.tip }}</li>
                {% endfor %}
              </ul>
            </li>
          {% endif %}

          {% if not prediction.recommendations and not prediction.maintain %}
            <li>üëè Your inputs are well-balanced. Keep it up!</li>
          {% endif %}
        </ul>
      </div>

      <!-- Download PDF form: server supplies recommendations_packed -->
      <form action="{{ url_for('download_pdf') }}" method="POST" style="margin-top:1rem;">
          <input type="hidden" name="patient_name" value="{{ username }}">
          <input type="hidden" name="symptoms" value="{{ request.form.get('symptoms','') }}">
          <input type="hidden" name="symptoms_long" value="{{ request.form.get('symptoms_long','') }}">
          <input type="hidden" name="prediction" value="{{ prediction.level }}">
          <input type="hidden" name="recommendations" value="{{ recommendations_packed }}">
          <button type="submit" class="btn-primary-full">üìÑ Download PDF Report</button>
      </form>

    </div>
    {% endif %}
  </div>
 </div>

 <script>
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    const valueSpan = document.getElementById(`${slider.id}-value`);
    slider.addEventListener('input', () => valueSpan.textContent = slider.value);
  });
 </script>
</body>
</html>
